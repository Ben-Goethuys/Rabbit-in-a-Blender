# Explanation
When we download the vocabularies from Athena, the concepts of the CPT4 vocabulary are not present in the CONCEPT.csv, while they are present in the other vocabulary csv's. Along with the concept files, there are scripts (cpt.sh, cpt.bat, cpt4.jar) to process the CONCEPT_CPT4.csv into the CONCEPT.csv file. Depending on your operating system, you can use the appropriate script. We work on the inno-linux, thus use the cpt.sh script. The other scripts do exactly the same. The CONCEPT_CPT4.csv is almost entirely the same as the CONCEPT.csv, but there are no concept_names filled in, which is necessary in the concept table! Therefore, we provide an API KEY for UMLS through which the script can link the concepts in the CONCEPT_CPT4.csv to the corresponding concepts in the UMLS database. Afterwards, the CPT4 concepts are added to the CONCEPT.csv file.


# Steps

1. Open git bash

2. Copy folder to inno-linux (ideally we could run it on windows, but then we get a java heap space error.)

```bash
CURRENT_DATE=20240329
scp -r "/v/WG_Innovatie/09 RADAR team/OMOP dagen/vocabulary_${CURRENT_DATE}_no_CPT4.zip" $(whoami)@inno-linux.azdelta.be:/home/$(whoami)/git/radar_omop-cdm/
```

3. Search for the API_KEY in bitwarden.

<img width="466" alt="image" src="https://github.com/RADar-AZDelta/radar_omop-cdm/assets/98480071/6222de19-cdda-4a5f-81c6-ed9c61870d9a">

4. Run the commands below in the terminal on inno-linux

```bash
CURRENT_DATE=20240329
unzip vocabulary_${CURRENT_DATE}_no_CPT4.zip -d vocabulary_${CURRENT_DATE}_no_CPT4
cd vocabulary_${CURRENT_DATE}
API_KEY=.....
bash cpt.sh ${API_KEY} 
```

Now wait a bit, this takes a while. Also, it happens that the first run, not all concepts are processed. This will be mentioned in the logfiles and you will have to run the script again.
Normally, all concepts are processed after the second run.

5. ZIP the files to make the folder ready for riab

```bash
cd vocabulary_${CURRENT_DATE}_no_CPT4
zip -r ../vocabulary_${CURRENT_DATE}.zip ./*
```

6. Transfer the folder back to V-folder for others to use (run this in git bash locally)

```bash
CURRENT_DATE=20240329
scp $(whoami)@inno-linux.azdelta.be:/home/$(whoami)/git/radar_omop-cdm/vocabulary_${CURRENT_DATE}.zip "/v/WG_Innovatie/09 RADAR team/OMOP dagen" 
```
